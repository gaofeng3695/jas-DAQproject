<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>组织机构管理</title>
  <!-- <link rel="stylesheet" href="./libelement-ui/element-#0E2B4A/src/index.css"> -->
  <link rel="stylesheet" href="./../../lib/element-ui/v2.4.1/theme-chalk/index.min.css">
  <link rel="stylesheet" href="./../../lib/font-awesome-4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="./../../src/css/main.css">
  <style>
    .height {
      height: 100% !important;
    }

    .chartTable {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      background: #f3f8fc;
    }

    .chartTable tr th,
    .chartTable tr td {
      text-align: center;
      border: 1px solid #cad9ea;
      padding: 6px 6px;
      color: #333;
      font-weight: normal;
      word-wrap: break-word;
      word-break: break-all;
      line-height: 1.8;
    }
  </style>
</head>

<body>
  <div id="app" v-cloak>
    <div style="padding:10px;box-sizing: border-box;height: 100%;">
      <statistic-group-project title="线路物资分月统计" :search="materialByMonth" :datetype="proDate" @requestnet="requestMaterialByMonth"></statistic-group-project>
      <el-row :gutter="10" style="padding-top:10px">
        <el-col :xs="24" :sm="24" :md="24" :lg="24" :xl="24" class="height">
          <el-card style="margin-bottom: 10px">
            <div id="materialByMonth" style="width:100%;height:300px;">

            </div>
          </el-card>
        </el-col>
      </el-row>


      <!--<div style="background:#999;height:35px;line-height: 35px;">
        <div style="float:left;padding:0px 10px;">
          线路物资日统计
        </div>
        <div style="float:right;padding-right:10px;">
          <jas-project-select @requestnet="requestNet" :selprojectoids="topSearch.projectOids"></jas-project-select>
          <el-date-picker v-model="value1" type="year" placeholder="选择年" style="padding-left:10px" size="mini">
          </el-date-picker>
        </div>
      </div>
      <el-row :gutter="10" style="padding-top:10px">
        <el-col :xs="24" :sm="24" :md="24" :lg="24" :xl="24" class="height">
          <el-card style="margin-bottom: 10px">
            <div id="process" style="width:100%;height:160px;">

            </div>
          </el-card>
        </el-col>
      </el-row>-->



      <!--<div style="background:#999;height:35px;line-height: 35px;">
        <div style="float:left;padding:0px 10px;">
          标段-线路物资累计统计
        </div>
        <div style="float:right;padding-right:10px;">
          <jas-project-select @requestnet="requestNet" :selprojectoids="topSearch.projectOids"></jas-project-select>
          <el-date-picker v-model="value1" type="year" placeholder="选择年" style="padding-left:10px" size="mini">
          </el-date-picker>
        </div>
      </div>
      <el-row :gutter="10" style="padding-top:10px">
        <el-col :xs="24" :sm="24" :md="24" :lg="24" :xl="24" class="height">
          <el-card style="margin-bottom: 10px">
            <div id="process" style="width:100%;height:160px;">

            </div>
          </el-card>
        </el-col>
      </el-row>-->

      <statistic-group title="标段-线路物资使用情况统计" @requestnet="requestTable" :search="searchTable"></statistic-group>
      <el-row :gutter="10" style="padding-top:10px">
        <el-col :xs="24" :sm="24" :md="24" :lg="24" :xl="24" class="height">
          <el-card style="margin-bottom: 10px">
            <!--进行标段table表格的绘制-->
            <div style="width:100%;">
              <table class="chartTable">
                <tr>
                  <th rowspan="2">标段</th>
                  <th rowspan="2">管材类型</th>
                  <th colspan="5">管材（KM）</th>
                  <th colspan="5">热弯（根）</th>
                </tr>
                <tr>
                  <th>累计接收</th>
                  <th>累计使用</th>
                  <th>当月接收</th>
                  <th>当月使用</th>
                  <th>截止当月剩余</th>
                  <th>累计接收</th>
                  <th>累计使用</th>
                  <th>当月接收</th>
                  <th>当月使用</th>
                  <th>截止当月剩余</th>
                </tr>
                <template v-for="type in chartTable" v-if="type.dataList.length>0">
                  <tr>
                    <td :rowspan="type.dataList.length" v-text="type.CONSTRUTIONNAME"></td>
                    <td v-text="type.dataList[0].specification"></td>
                    <td v-text="type.dataList[0].mpipetotal"></td>
                    <td v-text="type.dataList[0].mpipeusetotal"></td>
                    <td v-text="type.dataList[0].steelpipenum"></td>
                    <td v-text="type.dataList[0].steelpipelength"></td>
                    <td v-text="type.dataList[0].mpipetotallength"></td>
                    <td v-text="type.dataList[0].hotpipetotal"></td>
                    <td v-text="type.dataList[0].hotpipeusetotal"></td>
                    <td v-text="type.dataList[0].hotpipetotalnum"></td>
                    <td v-text="type.dataList[0].hotpipenums"></td>
                    <td v-text="type.dataList[0].slength"></td>
                  </tr>
                  <template v-for="item,index in type.dataList">
                    <tr v-if="index>0">
                      <td v-text="item.specification"></td>
                      <td v-text="item.mpipetotal"></td>
                      <td v-text="item.mpipeusetotal"></td>
                      <td v-text="item.steelpipenum"></td>
                      <td v-text="item.steelpipelength"></td>
                      <td v-text="item.mpipetotallength"></td>
                      <td v-text="item.hotpipetotal"></td>
                      <td v-text="item.hotpipeusetotal"></td>
                      <td v-text="item.hotpipetotalnum"></td>
                      <td v-text="item.hotpipenums"></td>
                      <td v-text="item.slength"></td>
                    </tr>
                  </template>
                </template>
              </table>
            </div>
          </el-card>
        </el-col>
      </el-row>

    </div>
  </div>

</body>

<script src="./../../lib/jquery/jquery-1.12.4.min.js"></script>
<script src="./../../lib/vue/vue.js"></script>
<script src="./../../lib/echarts/echarts.js"></script>
<script src="./../../lib/vue-multipane/vue-multipane.js"></script>
<script src="./../../lib/element-ui/v2.4.1/index.min.js"></script>
<script src="./../../common/components/jas-components.js"></script>
<script src="./../../common/js/jas-tools.js"></script>
<script>
  var color = ['#396fff', '#5eb6f9', '#c2e4fd', '#dde6ff', '#e5e5e5', '#e1e9ff', '#FF99CC', '#99CCFF', '##FF9900',
    '#FF9900', '#CCFF66'
  ];
  var vm = new Vue({
    el: '#app',
    data: function () {
      return { icon: 'path://M30.9,53.2C16.8,53.2,5.3,41.7,5.3,27.6S16.8,2,30.9,2C45,2,56.4,13.5,56.4,27.6S45,53.2,30.9,53.2z M30.9,3.5C17.6,3.5,6.8,14.4,6.8,27.6c0,13.3,10.8,24.1,24.101,24.1C44.2,51.7,55,40.9,55,27.6C54.9,14.4,44.1,3.5,30.9,3.5z M36.9,35.8c0,0.601-0.4,1-0.9,1h-1.3c-0.5,0-0.9-0.399-0.9-1V19.5c0-0.6,0.4-1,0.9-1H36c0.5,0,0.9,0.4,0.9,1V35.8z M27.8,35.8 c0,0.601-0.4,1-0.9,1h-1.3c-0.5,0-0.9-0.399-0.9-1V19.5c0-0.6,0.4-1,0.9-1H27c0.5,0,0.9,0.4,0.9,1L27.8,35.8L27.8,35.8z',
        searchTable: {
          projectOid: '',
          date: new Date()
        },
        chartTable: [],
        proDate: {
          type: "year",
          placeholder: "请选择年"
        },
        materByMonthChart: "",
        materialByMonth: {
          projectOids: [],
          date: new Date()
        },
      }
    },
    watch: {

    },
    mounted: function () {
      var that = this;
      $(window).resize(function () {
        that.materByMonthChart.resize();
      });
    },
    methods: {
      requestTable: function (projectOid, date) {
        var that = this;
        that.searchTable.projectOid = projectOid;
        that.searchTable.date = date;
        var url = "./data.json"
        jasTools.ajax.post(url, {
          projectOids: that.searchTable.projectOids,
          date: that.searchTable.date
        }, function (data) {
          that.chartTable = data.data;
        });
      },
      requestMaterialByMonth: function (projectOids, date) {
        var that = this;
        that.materialByMonth.projectOids = projectOids;
        that.materialByMonth.date = date;
        var url = jasTools.base.rootPath + "/daq/materialStatistics/getMonthlyStatistics.do";
        jasTools.ajax.post(url, {
          year: that.materialByMonth.date.getFullYear()
        }, function (data) {
          that.renderMaterialByMonth(data.data);
        });

      },
      renderMaterialByMonth: function (data) {
        var that = this;
        if (!that.materByMonthChart) {
          that.materByMonthChart = echarts.init(document.getElementById('materialByMonth'));
        }
        var option = {
          title: {
            left: 'center',
            top: '10px',
            text: "线路物资分月统计"
          },
          tooltip: {
            trigger: 'axis',
            axisPointer: {
              type: 'cross',
              crossStyle: {
                color: '#999'
              }
            }
          },
          toolbox: {
            show: true,
            orient: "horizontal",
            showTitle: true,
            feature: {
              myTool2: {
                show: true,
                title: '数据视图',
                icon: that.icon,
                onclick: function () {
                  top.jasTools.dialog.show({
                    width: '60%',
                    height: '80%',
                    title: '数据视图',
                    src: './pages/statistics/dialogs/materialViewData.html?isShow=materialByMonthViewData&projectOids=' +
                      that.materialByMonth.projectOids + "&date=" + jasTools.base.formatDate(that.materialByMonth
                        .date,
                        'yyyy-MM-dd'),
                    cbForClose: function () {

                    }
                  });
                }
              }
            },
            right: 30
          },
          legend: {
            data: ['钢管（KM）', '热煨弯管（KM）', '累计（KM）'],
            bottom: "-5px"
          },
          grid: {
            left: '3%',
            right: '4%',
            bottom: '7%',
            containLabel: true
          },
          xAxis: [{
            type: 'category',
            data: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
          }],
          yAxis: [{
              type: 'value',
            },
            {
              type: 'value',
            }
          ],
          series: [{
              name: '钢管（KM）',
              type: 'bar',
              stack: '总量',
              data: data.pipe
            },
            {
              name: '热煨弯管（KM）',
              type: 'bar',
              stack: '总量',
              data: data.hot_pipe
            },
            {
              name: '累计（KM）',
              type: 'line',
              yAxisIndex: 1,
              data: data.grand_total
            }
          ],
          color: color
        };
        that.materByMonthChart.setOption(option, true);
      }

    },
  });
</script>

</html>