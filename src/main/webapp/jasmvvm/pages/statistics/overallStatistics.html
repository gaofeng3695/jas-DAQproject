<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>组织机构管理</title>
  <!-- <link rel="stylesheet" href="./libelement-ui/element-#0E2B4A/src/index.css"> -->
  <link rel="stylesheet" href="./../../lib/element-ui/v2.4.1/theme-chalk/index.min.css">
  <link rel="stylesheet" href="./../../lib/font-awesome-4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="./../../src/css/main.css">
  <style>
    .height {
      height: 100% !important;
    }
  </style>
</head>

<body>
  <div id="app" v-cloak>
    <div style="padding:  0 15px 15px;box-sizing: border-box;height: 100%;" class="jas-flex-box is-vertical">
      <div ref="searchWrapper" style="border-bottom: 1px solid #e4e7ed;overflow:hidden;box-sizing:border-box;">
        <div style="padding:15px 0 10px;">
          <jas-search-for-list slot="search" :form="topSearch" :fields="fields" :fields-config="fieldsConfig" @search="searchList"></jas-search-for-list>
        </div>
      </div>
      <div class="jas-flex-box is-vertical is-grown">
        <div class="jas-flex-box is-vertical">
          <div class="jas-flex-box is-vertical is-grown">
            <div class="jas-flex-box is-horizontal  height">
              <div class="jas-flex-box is-vertical is-grown height">
             
                  <div id="process" style="width:100%;height:100%;">

                  </div>
   

              </div>
              <div class="jas-flex-box is-vertical is-grown height">
                <div id="month" style="width:100%;height:100%;">

                </div>
              </div>
            </div>
          </div>
          <div class="jas-flex-box is-vertical is-grown">
            <div class="jas-flex-box is-horizontal height">
              <div class="jas-flex-box is-vertical is-grown height">
                <div id="yield" style="width:100%;height:100%;">

                </div>
              </div>
              <div class="jas-flex-box is-vertical is-grown height">
                <div id="inputAndCheck" style="width:100%;height:100%">

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

<script src="./../../lib/jquery/jquery-1.12.4.min.js"></script>
<script src="./../../lib/vue/vue.js"></script>
<script src="./../../lib/echarts/echarts.js"></script>
<script src="./../../lib/vue-multipane/vue-multipane.js"></script>
<script src="./../../lib/element-ui/v2.4.1/index.min.js"></script>
<script src="./../../common/components/jas-components.js"></script>
<script src="./../../common/js/jas-tools.js"></script>
<script>
  var vm = new Vue({
    el: '#app',
    data: function () {
      return {
        topSearch: {
          projectOids: ['9d0b31ca-ec1a-4ebe-8a9e-32a55fa5eeba', '8897c66d-b622-45ca-9cfd-405017447ed2'],
        },
        fields: [{
          field: "projectOid",
          name: "项目名称"
        }],
        fieldsConfig: {
          projectOid: {
            type: 'select',
            optionUrl: '/daq/privilege/getProjectList.do',
          },
        },
        fieldsMap: {
          "pipe": {
            name: '管材(km)'
          },
          "weld": {
            name: '焊接(km)'
          },
          "patch": {
            name: '补口(km)'
          },
          "lay_surveying": {
            name: '测量放线(km)'
          },
          "lay_land_restoration": {
            name: '地貌恢复(km)'
          },
          "lay_pipe_trench_backfill": {
            name: '管沟回填(km)'
          },
          "total": {
            name: '已录入'
          },
          "needAudit": {
            name: "需要审核"
          },
          "audited": {
            name: "已审核"
          }
        },
        myChart: "",
        yield: "", //合格率
        inputAndCheck: "", //数据录入/审核统计
        month: "", //分月
      }
    },
    watch: {

    },
    mounted: function () {
      var that = this;
      that.requestProcess();
      that.requestYield();
      that.requestInputAndCheck();
      that.requestMonth();
      $(window).resize(function () {
        that.myChart.resize();
        that.yield.resize();
        that.inputAndCheck.resize();
        that.month.resize();
      });
    },
    methods: {
      searchList: function () {

      },
      requestMonth: function () {
        var that = this;
         var url = jasTools.base.rootPath + "/overallStatistics/processMonthlyCompletion.do";
         jasTools.ajax.post(url, that.topSearch, function (data) {
           console.log(data);
         });
        that.renderMonth();
      },
      requestYield: function () {
        var that = this;
        var url = jasTools.base.rootPath + "/overallStatistics/statsDetectionRayPassCount.do";
        jasTools.ajax.post(url, that.topSearch, function (data) {
          var pass;
          var noPass;
          if (data.data.count == 0) {
            pass = 1;
            noPass = 0;
          } else {
            pass = data.data.passCount / data.data.count;
            noPass = (data.data.count - data.data.passCount) / data.data.count;
          }
          that.renderYield(pass, noPass);
        });
      },
      requestInputAndCheck: function () {
        var that = this;
        var x = [];
        var y = [];
        var url = jasTools.base.rootPath + "/overallStatistics/dataEntryAudit.do";
        jasTools.ajax.post(url, that.topSearch, function (data) {
          for (var key in data.data) {
            x.push(that.fieldsMap[key].name);
            y.push(data.data[key]);
          }

          that.renderInputAndCheck(x, y);
        });
      },
      requestProcess: function () {
        var that = this;
        var x = [];
        var y = [];
        var url = jasTools.base.rootPath + "/overallStatistics/processCumulativeCompletion.do";
        jasTools.ajax.post(url, that.topSearch, function (data) {
          data.data.forEach(function (item, index) {
            var type = item.statsType;
            x.push(that.fieldsMap[type].name);
            y.push(item.statsResult || 0);
          });
          that.renderChart(x, y);
        });
      },
      renderMonth: function () {
        var that = this;
        that.month = echarts.init(document.getElementById('month'));
        option = {
        	    title: {
        	        text: '各工序分月完成情况对比',
        	        left: 'center',
                    top: '10px'
        	    },
        	    tooltip: {
        	        trigger: 'axis'
        	    },
        	    legend: {
        	        data:['管材(km)','测量放线(km)','焊接(km)','补口(km)','管沟回填(km)','地貌恢复(km)'],
        	        bottom:"-5px"
        	    },
        	    grid: {
        	        left: '3%',
        	        right: '4%',
        	        bottom: '3%',
        	        containLabel: true
        	    },
  
        	    xAxis: {
        	        type: 'category',
        	        boundaryGap: false,
        	        data: ['1月','2月','3月','4月','5月','6月','7月']
        	    },
        	    yAxis: {
        	        type: 'value'
        	    },
        	    series: [
        	        {
        	            name:'管材(km)',
        	            type:'line',
        	            stack: '总量',
        	            itemStyle:{
        	            	color:'#5b9bd5'
        	            },
        	            data:[120, 132, 101, 134, 90, 230, 210]
        	        },
        	        {
        	            name:'测量放线(km)',
        	            type:'line',
        	            stack: '总量',
        	            itemStyle:{
        	            	color:'#ed7d31'
        	            },
        	            data:[220, 182, 191, 234, 290, 330, 310]
        	        },
        	        {
        	            name:'焊接(km)',
        	            type:'line',
        	            stack: '总量',
        	            itemStyle:{
        	            	color:'#a5a5a5'
        	            },
        	            data:[150, 232, 201, 154, 190, 330, 410]
        	        },
        	        {
        	            name:'补口(km)',
        	            type:'line',
        	            stack: '总量',
        	            itemStyle:{
        	            	color:'#ffc000'
        	            },
        	            data:[320, 332, 301, 334, 390, 330, 320]
        	        },
        	        {
        	            name:'管沟回填(km)',
        	            type:'line',
        	            stack: '总量',
        	            itemStyle:{
        	            	color:'#4472c4'
        	            },
        	            data:[820, 932, 901, 934, 1290, 1330, 1320]
        	        },{
        	            name:'地貌恢复(km)',
        	            type:'line',
        	            stack: '总量',
        	            itemStyle:{
        	            	color:'#70ad47'
        	            },
        	            data:[820, 932, 901, 934, 1290, 1330, 1320]
        	        }
        	    ]
        	};
        that.month.setOption(option);
      },
      renderInputAndCheck: function (x, y) {
        var that = this;
        var y0 = [];
        var y1 = [];
        var y2 = [];
        y0[0] = y[2];
        y1[0] = y[1];
        y2[0] = y[0];
        that.inputAndCheck = echarts.init(document.getElementById('inputAndCheck'));
        var option = {
          title: {
            text: '数据录入/审核统计',
            left: 'center',
            top: '10px'
          },
          tooltip: {
            trigger: 'axis',
          },
          legend: {
            show: true,
            bottom: '-5px',
            data: ['已录入', '已审核', '需要审核']
          },
          grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
          },
          xAxis: {
            type: 'value',
            boundaryGap: [0, 0.01]
          },
          yAxis: {
            type: 'category',
            data: []
          },
          series: [{
            name: '已审核',
            label: {
              show: true,
              position: 'inside'
            },
            itemStyle: {
              color: "#a5a5a5"
            },
            type: 'bar',
            data: y0
          }, {
            name: '需要审核',
            label: {
              show: true,
              position: 'inside'
            },
            itemStyle: {
              color: "#ed7d31"
            },
            type: 'bar',
            data: y1
          }, {
            name: '已录入',
            label: {
              show: true,
              position: 'inside'
            },
            itemStyle: {
              color: "#5b9bd5"
            },
            type: 'bar',
            data: y2
          }]
        };
        that.inputAndCheck.setOption(option);
      },
      renderYield: function (pass, noPass) {
        var that = this;
        that.yield = echarts.init(document.getElementById('yield'));
        var option = {
          title: {
            text: '一次合格率统计',
            top: '10px',
            x: 'center'
          },
          tooltip: {
            trigger: 'item',
            formatter: "{a} <br/>{b} : {c} ({d}%)"
          },
          legend: {
            bottom: '0px',
            data: ['合格焊口数', '不合格焊口数']
          },
          series: [{
            name: '访问来源',
            type: 'pie',
            radius: '55%',
            center: ['50%', '60%'],
            data: [{
                value: pass,
                name: '合格焊口数',
                itemStyle: {
                  color: "#5c9edb"
                },
              },
              {
                value: noPass,
                name: '不合格焊口数',
                itemStyle: {
                  color: "#f38645"
                },
              }
            ],
            itemStyle: {
              emphasis: {
                shadowBlur: 10,
                shadowOffsetX: 0,
                shadowColor: 'rgba(0, 0, 0, 0.5)'
              }
            }
          }]
        };
        that.yield.setOption(option);
      },
      renderChart: function (x, y) {
        var that = this;
        that.myChart = echarts.init(document.getElementById('process'));
        // 指定图表的配置项和数据
        var option = {
          title: {
            text: '各工序累计完成情况',
            left: 'center',
            top: '10px'
          },
          tooltip: {},
          xAxis: {
            data: x
          },
          yAxis: {
            min: 0,
            scale: true,
          },
          series: [{
            name: '工序',
            type: 'bar',
            label: {
              show: true,
              position: 'top'
            },
            itemStyle: {
              color: '#409EFF',
              shadowColor: 'rgba(0, 0, 0, 0.5)',
              shadowBlur: 10
            },
            data: y
          }]
        };
        that.myChart.setOption(option);
      }
    },
  });
</script>

</html>